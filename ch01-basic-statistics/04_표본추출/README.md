<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [01 표본 추출(sampling)](#01-표본-추출sampling)
  - [quota sampling이 왜 안되는가](#quota-sampling이-왜-안되는가)
  - [모집단의 구성비도 모수일텐데 어떻게 구성비를 맞추나요?](#모집단의-구성비도-모수일텐데-어떻게-구성비를-맞추나요)
  - [확률적 방법에 의한 표본 추출 (probability sampling)](#확률적-방법에-의한-표본-추출-probability-sampling)
  - [샘플링에 의해 발생할 수 있는 bias](#샘플링에-의해-발생할-수-있는-bias)
  - [비확률적 샘플링 (Non-probability sampling)](#비확률적-샘플링-non-probability-sampling)
- [02 표본 비율 -\> 모집단 비율 추론을 위한 표본 비율의 기대값과 표준오차](#02-표본-비율---모집단-비율-추론을-위한-표본-비율의-기대값과-표준오차)
  - [표본의 기대값과 표준오차(SE)](#표본의-기대값과-표준오차se)
  - [표본 비율의 표준 오차](#표본-비율의-표준-오차)
  - [비복원 추출의 표준 오차를 위한 보정계수](#비복원-추출의-표준-오차를-위한-보정계수)
  - [신뢰구간](#신뢰구간)
- [03 표본 평균 -\> 표본 평균의 기대값과 표준오차를 통해서 모집단의 평균을 추정하자.](#03-표본-평균---표본-평균의-기대값과-표준오차를-통해서-모집단의-평균을-추정하자)
  - [표본 평균으로 모평균을 추정하기(통계적 추론)](#표본-평균으로-모평균을-추정하기통계적-추론)
  - [뭐 이리 표준 오차 종류가 많음?](#뭐-이리-표준-오차-종류가-많음)

<!-- /code_chunk_output -->

## 01 표본 추출(sampling)

우리가 왜 통계를 내려고 하는가? 추론(inference)하려고.
추론이 뭔데? population에서 표본을 추출하여 모집단의 특성(모수, parameter) 을 추정하는 것

그런데 이 추론의 전제에는 `표본이 모집단을 대표해야 한다`는 가정이 필요하고, 그래서 표본 추출에는 기술이 필요하다

### quota sampling이 왜 안되는가

모집단은 다양한 집단으로 이루어져 있다. 그리고 이 집단들의 크기는 저마다 다르다. `집단에서 표본을 추출할 때 해당 집단들의 크기 별로 추출 확률을 보정해주어야 한다.` 쉽게 말하자면 `표본의 구성비를 모집단의 구성비에 맞추어야 한다.` 이 과정에서 우리는 표본의 구성비를 모집단의 구성비로 맞추기 위해서 quota sampling(할당 추출)을 하고 싶은 욕망에 빠진다.

quota sampling을 근본적으로 잘못되어 있다. 만약 성비라는 기준으로 모집단을 나눠서 그 비중이 7/3이라 표본에도 이를 반영해서 7/3으로 샘플링을 한다면, 성비외에의 나머지 특성에 대해서는 자의적으로 표본을 추출하게 된다. 성비를 맞추다보니 그 과정에서 자의가 개입된 것이다. 이는 표본이 모집단을 대표하지 못하게 된다.

표본을 추출할 때는 잘 해보겠다고 노력하는게 아니라 무작위, 확률적으로 추출해야 한다. 확률을 도구로써 이용해야 한다.

그렇다면 위의 성비는 아무 이득이 없는 정보였나? 그건 아니다. 확률적 방법에 의해 표본 추출한 후 가중치 부여를 통해서 집단별로 표본의 구성비를 모집단의 구성비와 같도록 조절할 수 있다.

### 모집단의 구성비도 모수일텐데 어떻게 구성비를 맞추나요?

`표본의 구성비를 모집단의 구성비에 맞추어야 한다`라고 했지만 현실에서는 모집단의 구성비를 모를 가능성이 높다. 모를 뿐더러 애초에 표본의 구성비는 모수의 구성비에 확률오차가 더해지기 마련이기에 같을 수 없다.

따라서, `모집단의 구성비를 표본의 구성비라고 가정하고 추정을 한다. 표본의 크기가 클수록 이 가정은 맞아 떨어진다.`
즉, 현실적으로는 표본을 뽑으면 해당 표본이 모집단을 대표한다라고 전제하고 넘어간 다음 분석을 시행한다는 것이다. 그래서 표본으로 bias가 생겨도 생각이 날카롭지 않으면 모르고 넘어가서 잘못된 추론을 하게 되는 것이고. 이래서 data job이 무섭다.

이러한 가정이 불만족스럽다면 구성 비율을 1/n로 나누어 계산해도 된다. 이 가정에 근거하여 SE를 계산해도 그렇게 크게 틀리지 않다.

### 확률적 방법에 의한 표본 추출 (probability sampling)

- 왜 확률적으로 샘플링을 해야 하는 가?

  - 표본추출편의(sample selection bias) 때문이다. 그러니까 샘플링을 잘못해서 전제 조건인 `표본이 모집단을 대표해야 한다`는 가정이 깨지는 것이다. 앞서 살펴본 quota sampling이 이러한 표본추출편의를 일으키는 방식이다.
  - literary digest 잡지사의 실수 사례. 잘못된 샘플링으로 대선 결과를 잘못 예측하고 회사가 휘청임.
  - 잘못된 방식) quota sampling -> 모집단의 구성비를 가늠해서 표본로 그러한 구성비를 가지게끔 샘플링하는 것인데 이는 처음부터 실험자의 주관이 개입된 잘못된 방식. 모든 것을 확률에 맡겨야 한다.

- 확률적 샘플링의 특징

  - 확률적 샘플링은 모집단을 이루는 개개의 구성원이 표본으로 선택될 확률을 계산할 수 있게 해준다. 그래서 `관측치별로 추출 확률의 역수로 가중치를 부여하여 표본의 구성비를 모집단의 구성비와 같게 만들 수 있다`
  - 표본추출확률을 정할 때 집단별로 그 크기에 따라 추출 확률을 조절해주어야 한다.
  - 가중치 부여를 통해 집단별로 표본의 구성비를 모집단의 구성비와 같도록 조절할 수 있다.

- 확률적 샘플링
  - Simple random sampling (단순 무작위 추출)
  - Stratified sampling (계층적 샘플링)
    - 모집단의 데이터 분포 비율을 유지하면서 데이터를 샘플링
  - Systematic sampling (계통 추출)
  - Cluster sampling
    - multistage cluster sampling (다단계 군집 추출)

### 샘플링에 의해 발생할 수 있는 bias

- sample selection bias 표본추출편의
- non-response bias 무응답편의
- response bias 응답편의
- household bias 가구편의

우리는 양적 연구를 하고 있기 때문에 확률적 샘플링에서 발생하는 bias를 다뤘지만 사실 bias는 질적 연구에서도 발생하며 실험 과정의 모든 단계에서 발생할 수 있다.

다양한 bias를 리스트를 확인해보고 싶다면 [scribbr](https://www.scribbr.com/category/research-bias/)의 글을 참고해보자.

### 비확률적 샘플링 (Non-probability sampling)

비확률적인 샘플링은 양적 연구에서 주로 사용한다.

- Convenience sampling
- Quota sampling
- Self-selection (volunteer) sampling
- Snowball sampling
- Purposive (judgmental) sampling

## 02 표본 비율 -> 모집단 비율 추론을 위한 표본 비율의 기대값과 표준오차

### 표본의 기대값과 표준오차(SE)

샘플링을 통해 확률의 세계에 존재했던 추정량은 실제값인 추정치가 되었다. 그리고 이 추정치는 bias와 확률오차로 인해 실제 모수와 다르다. 아래처럼 수식화할 수 있다.

```text
추정치 = 모수 + bias + 확률오차
```

표본의 구성비가 모집단의 구성비와 같을 것이라고 기대하지만 (E(x) 기대값) 확률 오차가 존재하여 실제론 다르다. 이 확률 조차의 표준적인 크기를 표본 비율의 표준오차(SE)로 부른다.

### 표본 비율의 표준 오차

앞서 `표본의 구성비를 모집단의 구성비에 맞추어야 한다`라고 했는데 실제로 샘플링을 진행해서 그 구성비를 모집단의 구성비와 비교하면 다르다. 이는 확률 오차에 의한 것이다. 수식으로 적어보면 다음과 같다.

$$
표본의\ 구성비 = 모수의\ 구성비(기댓값) + 표본의\ 구성비\ 표준오차
$$

0과 1로 이루어진 box-model에 기반하여 생각하면

$$
표본 비율(구성비)의 \ SE (\%) = \frac{합의\ SE}{표본크기} * 100 \%
$$

여기서 표본의 크기를 키워서 구성비의 표준 오차를 줄일 수 있다. 표본의 크기가 커질수록 표본 비율의 표준 오차는 작아진다. 이는 시행 횟수가 많아지면 시행 횟수에 비해 확률 오차의 상대적 크기가 작아지는 평균의 법칙과 맞닿아 있다.

또한, 표본의 크기가 클수록 중심극한정리(CLT)에 따라 합, 평균의 hist가 normal distribution에 가까워지므로 정규 분포 곡선을 계산에 활용할 수 있다. $\pm SE$에 따른 68, 95, 99.7 법칙도 당연히 따른다.

물론 표본을 까보니 표본 비율이 50%에 가깝지 않고 0%, 100%에 가깝다면 정규 분포로 근사하기에는 무리가 있다.

### 비복원 추출의 표준 오차를 위한 보정계수

직관적으로 생각하면 비복원 추출을 할 때, 불확실성은 조금씩 줄어들게 된다. 실제로 비복원 추출의 경우의 표본 비율의 SE는 복원추출인 경우의 SE보다 조금 작게 된다.

$$
비복원 추출 SE = 보정계수 \times 복원 추출 SE \\
보정계수 = \sqrt{\frac{상자모델\ 수 - 뽑힌 수}{상자모델\  수-1}}
$$

모집단의 크기가 표본 크기에 비해 압도적으로 크면 보정계수는 1에 가까워진다. 복원 추출과 크게 SE가 달라지지 않는 셈이다.

### 신뢰구간

샘플링을 통해 도출된 통계값은 표본의 양이 클수록 정규 분포를 따르므로 도출된 기댓값 $\pm SE$가 68-95-99.7 규칙을 따른다.

흔히 뉴스에서 볼 수 있는 95% 신뢰도를 가진 신뢰구간은 표본 비율 $\pm 2SE$에 해당한다.

다만, 표본의 크기가 클수록 표본 비율이 정규 분포를 따르기 때문에 이런 가정이 가능한 것인데, 만약 추출한 표본의 비율이 50%에 가깝지 않고 극단적인 0%, 100%에 가깝다면 모집단의 비율이 극단적일 것이라고 예상할 수 있을 것이고, 표본 추출을 통한 통계량이 의미 있으려면 표본의 수가 아주 커야 할 것이다.

## 03 표본 평균 -> 표본 평균의 기대값과 표준오차를 통해서 모집단의 평균을 추정하자.

### 표본 평균으로 모평균을 추정하기(통계적 추론)

이 부분은 지금까지 공부한 기초 통계학의 정리와도 같다. 예를 들어보자.

1. 어느 도시의 25,000 명의 연평균소득을 알고 싶다. 그래서 이들 중 1,000 명을 random sampling으로 뽑았다.
2. 1,000명의 평균은 3,240만원이었다.
   1. 문제는 이 표본 평균이 모 평균과 얼마나 차이가 나는지에 대한 확률 오차이다.
3. 표본의 SD를 구해보았더니 1,900만원이더라. 이 표본의 SD를 모집단의 SD로 가정하자.
   1. 이는 random sampling했기 때문에 가능한 것이다. 무작위가 아니라면 표본의 SD를 모집단의 SD로 사용할 수 없다
4. 표본합의 SE는 $\sqrt{표본 크기} \times SD$이므로 60,000만원이고 이를 1,000(명)으로 나누면 표본 평균의 SE인 60만원이 된다.
5. 표본 평균의 SE가 60만원이므로 우리는 95% 신뢰 구간에서 25,000명의 연평균소득을 3,240만원 $\pm$ 120만원으로 추정할 수 있다.
   1. CLT에 의해 표본의 수가 많다면 표본의 합이나 평균의 hist는 ND와 비슷해져 근사할 수 있기 때문이다.

위 과정을 정리하자면 다음과 같다

- 상자 모델은 모집단을 이해하기 쉽게 추상화한 것이다. 그래서 일반적으로 모집단(상자)의 SD는 모른다. 상식적으로 모집단의 표준 편차는 모수이므로 알 수가 없다.
- 우리는 표본 평균(sample mean)으로 모집단(상자)의 평균을 추정한다. 물론 확률 오차가 발생해서 조금 다르긴 하다. 얼마나 다른지 알기 위해서 표본 합, 평균의 SE를 구해야 한다.
  - 합에 대해서 구하면 평균은 자동으로 구해진다. 평균이란게 합을 표본 수로 나눈 것이니 그렇다.
  - 모집단의 평균도 모수이기 때문에 보통 모른다. 그러나 보통 표본 평균의 기대값은 모집단(상자) 평균과 같고 본다. sampling을 잘해서 표본이 모집단을 잘 대표한다고 가정하고 그냥 같다고 본다.
- 모집단(상자)이 정규 분포가 아니더라도 표본의 합과 평균은 정규분포를 따른다. CLT 때문에. 그래서 정규분포로 근사 가능하다.
- random sampling으로 표본을 추출했다면 표본의 SD($\sigma$, 표본표준편차)는 모집단의 SD와 같다고 볼 수 있고, 이를 이용해 표본합의 SE를 구할 수 있게 된다. $표본\ 합의\ SE = SD \times \sqrt{표본 크기}$공식을 활용한다.
  - 표본이 클수록 표본의 SD는 모집단의 SD와 비슷해진다.
  - 표본 평균의 SE를 구하고 싶다면 간단하게 표본 합의 SE를 표본 크기로 나누면 된다. 굳이 공식화 하자면 $SD / \sqrt{표본 크기}$이다
- 표본합의 SE과 CLT로 표본합, 평균의 정규분포성을 이용하여 68-95-99.7 법칙을 따라 신뢰 구간을 계산할 수 있다.

### 뭐 이리 표준 오차 종류가 많음?

확률로 추정된 값이 있으면 자연스레 확률 오차가 발생하는지라 많다. 따라서 그냥 표준 오차란 존재하지 않고 항상 무언가의 표준오차로 표기해야 한다.

아래 공식에서 표본 평균의 SE는 표본 합의 SE를 단순히 표본 크기로 나누어 구할 수 있다는 점을 유의하자.

$$
표본 합의\ SE = 모집단(상자)의 SD \times \sqrt{표본 크기}  \\
표본 평균의\ SE = 모집단(상자)의 SD / \sqrt{표본 크기}  \\
표본 개수의\ SE = 0-1 모집단(상자)의\ 표본합의\ SE   \\
표본 비율의\ SE = (표본 개수의\ SE / 표본 크기 ) \times 100\% \\
보통\ 모수는\ 알\ 수\ 없으므로\ 모집단(상자)의\ SD는\ 표본의\ SD로\ 대신함.
$$

- 물론 모집단(상자)의 SD는 모르는 것이 정상이기 때문에 앞서 언급한 순서대로 표본의 SD를 모집단의 SD로 간주하는 것이 대부분이다.
- 상자 모델 내 카드(선택지)가 2종류 뿐이라면(2개가 아니라 2 '종류'임에 유의) SD를 빠르게 계산할 수 있다

  $$
  (큰수 - 작은 수) \times \sqrt{(큰 수의 비율) \times (작은 수의 비율)}
  $$

- 표본의 합의 95% 신뢰구간을 구하고 싶다면 `표본 합`의 $\pm 2SE$를 사용하면 된다
- 표본의 평균의 95% 신뢰구간을 구하고 싶다면 `표본 평균`의 $\pm 2SE$를 사용하면 된다
